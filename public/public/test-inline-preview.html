<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline Preview Test</title>
    <link rel="stylesheet" href="/global.css">
    <link rel="stylesheet" href="/styles.css">
    <style>
        body {
            padding: 2rem;
            background: var(--background);
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            color: var(--text-primary);
            margin-bottom: 2rem;
        }
        .test-message {
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Inline Preview Test</h1>

        <div class="test-message">
            <h2>Test 1: Hero Section Preview</h2>
            <div class="message ai">
                <div class="message-avatar">N</div>
                <div class="message-bubble" id="test1"></div>
            </div>
        </div>

        <div class="test-message">
            <h2>Test 2: About Section Preview</h2>
            <div class="message ai">
                <div class="message-avatar">N</div>
                <div class="message-bubble" id="test2"></div>
            </div>
        </div>

        <div class="test-message">
            <h2>Test 3: Normal Message (No Preview)</h2>
            <div class="message ai">
                <div class="message-avatar">N</div>
                <div class="message-bubble" id="test3"></div>
            </div>
        </div>
    </div>

    <script>
        // Simulate the addMessage function behavior
        function renderMessage(elementId, content) {
            const bubble = document.getElementById(elementId);

            // Extract and render inline previews (same logic as app.js)
            const previewMatch = content.match(/\[PREVIEW:\s*section=(\w+)\]([\s\S]*?)\[\/PREVIEW\]/);

            if (previewMatch) {
                const section = previewMatch[1];
                const previewHtml = previewMatch[2].trim();
                const textWithoutTags = content.replace(/\[PREVIEW:[\s\S]*?\[\/PREVIEW\]/g, '').trim();

                // Add text (if any) before/after preview
                if (textWithoutTags) {
                    const textDiv = document.createElement('div');
                    textDiv.innerHTML = textWithoutTags.replace(/\n/g, '<br>');
                    bubble.appendChild(textDiv);
                }

                // Create inline preview container
                const previewContainer = document.createElement('div');
                previewContainer.className = 'inline-preview';

                const previewLabel = document.createElement('div');
                previewLabel.className = 'inline-preview-label';
                previewLabel.textContent = `${section.toUpperCase()} Preview`;

                const previewContent = document.createElement('div');
                previewContent.className = 'inline-preview-content';
                previewContent.innerHTML = previewHtml;

                previewContainer.appendChild(previewLabel);
                previewContainer.appendChild(previewContent);
                bubble.appendChild(previewContainer);
            } else {
                // Normal message (no preview tags)
                bubble.innerHTML = content.replace(/\n/g, '<br>');
            }
        }

        // Test 1: Hero section with image
        renderMessage('test1',
            `Here's how your hero section will look:\n\n[PREVIEW: section=hero]
<div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <h1 style="font-size: 3rem; margin-bottom: 1rem;">Welcome to StarterNode</h1>
    <p style="font-size: 1.25rem; margin-bottom: 2rem;">Build amazing websites with AI assistance</p>
    <button style="background: white; color: #667eea; padding: 1rem 2rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer;">Get Started</button>
</div>
[/PREVIEW]\n\nWhat do you think?`
        );

        // Test 2: About section
        renderMessage('test2',
            `Great! Now let's preview your about section:\n\n[PREVIEW: section=about]
<div style="padding: 2rem; background: white; border-radius: 8px;">
    <h2 style="color: #333; margin-bottom: 1rem;">About Us</h2>
    <p style="color: #666; line-height: 1.6;">We are a team of passionate developers dedicated to helping businesses create stunning websites. With over 10 years of experience, we've helped hundreds of clients achieve their online goals.</p>
    <ul style="color: #666; margin-top: 1rem;">
        <li>Custom website development</li>
        <li>AI-powered design assistance</li>
        <li>Responsive and modern layouts</li>
    </ul>
</div>
[/PREVIEW]\n\nLooks good?`
        );

        // Test 3: Normal message
        renderMessage('test3',
            'Perfect! I\'ve saved those sections. Ready to move on to the services section?'
        );
    </script>
</body>
</html>
